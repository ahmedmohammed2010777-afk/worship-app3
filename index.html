<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø§Ø¨ Ø¹Ø§Ø¦Ù„ØªÙŠ 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a4d2e; --gold: #c5a059; --bg: #f9f6f0; }
        body {
            font-family: 'Amiri', serif; background-color: var(--bg);
            background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png');
            margin: 0; padding: 10px; color: #2c3e50;
        }
        .main-container {
            max-width: 800px; margin: auto; background: rgba(255,255,255,0.98);
            border: 3px double var(--gold); border-radius: 20px; padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1, h2, h3 { font-family: 'Reem Kufi', sans-serif; color: var(--primary); text-align: center; }

        .header-bar {
            background: var(--primary); color: white; padding: 15px;
            border-radius: 15px; border: 1px solid var(--gold); margin-bottom: 20px; text-align: center;
        }
        input[type="date"] { background: var(--gold); border: none; color: white; padding: 5px; border-radius: 5px; font-family: 'Amiri'; cursor: pointer; }

        /* Ø¨ÙˆØ¯ÙŠÙˆÙ… Ø§Ù„Ù…Ù†Ø§ÙØ³Ø© */
        .podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 10px; margin: 30px 0; height: 150px; }
        .podium-step { background: var(--primary); color: white; width: 80px; text-align: center; border-radius: 10px 10px 0 0; position: relative; border: 1px solid var(--gold); }
        .step-2 { height: 70%; background: #95a5a6; } /* ÙØ¶ÙŠ */
        .step-1 { height: 100%; background: var(--gold); } /* Ø°Ù‡Ø¨ÙŠ */
        .step-3 { height: 50%; background: #cd7f32; } /* Ø¨Ø±ÙˆÙ†Ø²ÙŠ */
        .podium-name { position: absolute; top: -25px; width: 100%; font-weight: bold; color: var(--primary); font-size: 0.9rem; }

        /* Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙˆÙ† */
        .competitors-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .comp-card { background: white; border: 2px solid var(--gold); border-radius: 15px; padding: 10px; transition: 0.3s; cursor: pointer; }
        .comp-card.active { box-shadow: 0 0 15px var(--gold); border-width: 3px; background: #fffdf5; }
        .comp-name { font-weight: bold; color: var(--primary); border-bottom: 1px solid var(--gold); }
        .score { font-size: 1.2rem; color: var(--gold); font-weight: bold; }
        .remaining-list { font-size: 0.75rem; color: #a04040; margin-top: 5px; height: 35px; overflow: hidden; }

        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© (Ù…Ø³Ø¬Ø¯/ÙØ±Ø¯/Ù‚Ø¶Ø§Ø¡) */
        .prayer-options { display: flex; gap: 5px; }
        .opt-btn { font-size: 0.7rem; padding: 3px 6px; border-radius: 4px; border: 1px solid #ddd; cursor: pointer; background: #f9f9f9; }
        .opt-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }

        .section-card { background: white; border: 1px solid #ddd; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .habit-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed #eee; }
        .chat-box { height: 100px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #fff; border-radius: 8px; margin-bottom: 10px; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="main-container">
    <h1>ğŸ•Œ Ù…Ø­Ø±Ø§Ø¨ Ø¹Ø§Ø¦Ù„ØªÙŠ</h1>

    <div class="header-bar">
        <div><span>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: </span><input type="date" id="date-picker" onchange="updateView()"></div>
        <div id="hijri-display" style="margin-top:10px; color: var(--gold); font-weight: bold;"></div>
    </div>

    <h3>ğŸ† Ù…Ù†ØµØ© Ø§Ù„ØªØªÙˆÙŠØ¬</h3>
    <div class="podium-container" id="podium">
        <div class="podium-step step-2"><div class="podium-name" id="rank-2">-</div>Ù¢</div>
        <div class="podium-step step-1"><div class="podium-name" id="rank-1">-</div>Ù¡</div>
        <div class="podium-step step-3"><div class="podium-name" id="rank-3">-</div>Ù£</div>
    </div>

    <div class="competitors-grid">
        <div class="comp-card active" id="card-Ù…Ø­Ù…Ø¯" onclick="selectUser('Ù…Ø­Ù…Ø¯')">
            <div class="comp-name">Ø§Ù„Ø£Ø¨ Ù…Ø­Ù…Ø¯</div>
            <div class="score">âœ¨ <span id="score-Ù…Ø­Ù…Ø¯">0</span></div>
            <div class="remaining-list" id="rem-Ù…Ø­Ù…Ø¯"></div>
        </div>
        <div class="comp-card" id="card-Ø´ÙŠÙ…Ø§Ø¡" onclick="selectUser('Ø´ÙŠÙ…Ø§Ø¡')">
            <div class="comp-name">Ø§Ù„Ø£Ù… Ø´ÙŠÙ…Ø§Ø¡</div>
            <div class="score">âœ¨ <span id="score-Ø´ÙŠÙ…Ø§Ø¡">0</span></div>
            <div class="remaining-list" id="rem-Ø´ÙŠÙ…Ø§Ø¡"></div>
        </div>
        <div class="comp-card" id="card-Ø£Ø­Ù…Ø¯" onclick="selectUser('Ø£Ø­Ù…Ø¯')">
            <div class="comp-name">Ø£Ø­Ù…Ø¯</div>
            <div class="score">âœ¨ <span id="score-Ø£Ø­Ù…Ø¯">0</span></div>
            <div class="remaining-list" id="rem-Ø£Ø­Ù…Ø¯"></div>
        </div>
        <div class="comp-card" id="card-ÙŠØ§Ø³ÙŠÙ†" onclick="selectUser('ÙŠØ§Ø³ÙŠÙ†')">
            <div class="comp-name">ÙŠØ§Ø³ÙŠÙ†</div>
            <div class="score">âœ¨ <span id="score-ÙŠØ§Ø³ÙŠÙ†">0</span></div>
            <div class="remaining-list" id="rem-ÙŠØ§Ø³ÙŠÙ†"></div>
        </div>
    </div>

    <h2 id="current-user-title" style="font-size: 1.2rem;">ØªØ³Ø¬ÙŠÙ„: Ù…Ø­Ù…Ø¯</h2>

    <div class="section-card">
        <h3>ğŸ•‹ Ø§Ù„ÙØ±ÙˆØ¶ (Ù…Ø³Ø¬Ø¯ 50Ù† | ÙØ±Ø¯ 25Ù† | Ù‚Ø¶Ø§Ø¡ 10Ù†)</h3>
        <div id="list-fard"></div>
    </div>

    <div class="section-card">
        <h3>âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù†ÙˆØ§ÙÙ„</h3>
        <div id="list-sunan"></div>
    </div>

    <div class="section-card">
        <h3>ğŸ“– Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£ÙˆØ±Ø§Ø¯</h3>
        <div id="list-azkar"></div>
    </div>

    <div class="section-card">
        <div id="chat-msgs" class="chat-box"></div>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="chat-input" placeholder="Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…..." style="flex:1;">
            <button onclick="sendMsg()" style="background:var(--primary); color:white; border:none; padding:5px 15px; border-radius:5px;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<script>
    let currentUser = 'Ù…Ø­Ù…Ø¯';
    const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];
    const habits = {
        fard: [
            {id: 'fajr', name: 'Ø§Ù„ÙØ¬Ø±'}, {id: 'dhuhr', name: 'Ø§Ù„Ø¸Ù‡Ø±'},
            {id: 'asr', name: 'Ø§Ù„Ø¹ØµØ±'}, {id: 'maghrib', name: 'Ø§Ù„Ù…ØºØ±Ø¨'}, {id: 'isha', name: 'Ø§Ù„Ø¹Ø´Ø§Ø¡'}
        ],
        sunan: [
            {id: 's_fajr', name: 'Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø± (Ù¢ Ù‚Ø¨Ù„)', pts: 10},
            {id: 's_dhuhr_b', name: 'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø± (Ù¤ Ù‚Ø¨Ù„)', pts: 10},
            {id: 's_dhuhr_a', name: 'Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø± (Ù¢ Ø¨Ø¹Ø¯)', pts: 10},
            {id: 's_maghrib', name: 'Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨ (Ù¢ Ø¨Ø¹Ø¯)', pts: 10},
            {id: 's_isha', name: 'Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ (Ù¢ Ø¨Ø¹Ø¯)', pts: 10},
            {id: 'duha', name: 'Ø§Ù„Ø¶Ø­Ù‰', pts: 15}, {id: 'witr', name: 'Ø§Ù„Ø´ÙØ¹ ÙˆØ§Ù„ÙˆØªØ±', pts: 15}
        ],
        azkar: [
            {id: 'morn', name: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', pts: 20, link: 'https://alazkar.today/'},
            {id: 'even', name: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', pts: 20, link: 'https://alazkar.today/'},
            {id: 'sleep', name: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…', pts: 20, link: 'https://alazkar.today/'},
            {id: 'mulk', name: 'Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ', pts: 30, link: 'https://quran.com/67'},
            {id: 'kahf', name: 'Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù', pts: 50, link: 'https://quran.com/18', friday: true}
        ]
    };

    function updateView() {
        const date = document.getElementById('date-picker').value;
        document.getElementById('hijri-display').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(new Date(date));
        refreshAll();
    }

    function selectUser(user) {
        currentUser = user;
        document.querySelectorAll('.comp-card').forEach(c => c.classList.remove('active'));
        document.getElementById('card-' + user).classList.add('active');
        document.getElementById('current-user-title').innerText = "ØªØ³Ø¬ÙŠÙ„: " + user;
        refreshAll();
    }

    function setFard(id, type, pts) {
        const date = document.getElementById('date-picker').value;
        const key = `v4_${currentUser}_${date}_${id}`;
        localStorage.setItem(key, type);
        localStorage.setItem(key+'_pts', pts);
        refreshAll();
    }

    function toggleHabit(id, pts) {
        const date = document.getElementById('date-picker').value;
        const key = `v4_${currentUser}_${date}_${id}`;
        const done = localStorage.getItem(key) === 'true';
        localStorage.setItem(key, !done);
        localStorage.setItem(key+'_pts', !done ? pts : 0);
        refreshAll();
    }

    function refreshAll() {
        const date = document.getElementById('date-picker').value;
        const isFriday = new Date(date).getDay() === 5;
        let rankings = [];

        users.forEach(u => {
            let score = 0; let rem = [];
            habits.fard.forEach(h => {
                const status = localStorage.getItem(`v4_${u}_${date}_${h.id}`) || 'none';
                if(status === 'none') rem.push(h.name);
                else score += parseInt(localStorage.getItem(`v4_${u}_${date}_${h.id}_pts`) || 0);
            });
            [...habits.sunan, ...habits.azkar].forEach(h => {
                if(h.friday && !isFriday) return;
                const done = localStorage.getItem(`v4_${u}_${date}_${h.id}`) === 'true';
                if(done) score += h.pts; else rem.push(h.name);
            });
            document.getElementById(`score-${u}`).innerText = score;
            document.getElementById(`rem-${u}`).innerText = "Ø¨Ø§Ù‚ÙŠ: " + rem.slice(0,2).join('ØŒ ');
            rankings.push({name: u, score: score});
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙˆØ¯ÙŠÙˆÙ…
        rankings.sort((a,b) => b.score - a.score);
        document.getElementById('rank-1').innerText = rankings[0].name;
        document.getElementById('rank-2').innerText = rankings[1].name;
        document.getElementById('rank-3').innerText = rankings[2].name;

        renderFard(date);
        renderSimpleList('list-sunan', habits.sunan, date);
        renderSimpleList('list-azkar', habits.azkar, date, isFriday);
    }

    function renderFard(date) {
        const container = document.getElementById('list-fard');
        container.innerHTML = habits.fard.map(h => {
            const val = localStorage.getItem(`v4_${currentUser}_${date}_${h.id}`) || 'none';
            return `
                <div class="habit-row">
                    <span>${h.name}</span>
                    <div class="prayer-options">
                        <div class="opt-btn ${val==='mosque'?'selected':''}" onclick="setFard('${h.id}','mosque',50)">Ù…Ø³Ø¬Ø¯</div>
                        <div class="opt-btn ${val==='home'?'selected':''}" onclick="setFard('${h.id}','home',25)">ÙØ±Ø¯</div>
                        <div class="opt-btn ${val==='late'?'selected':''}" onclick="setFard('${h.id}','late',10)">Ù‚Ø¶Ø§Ø¡</div>
                        <div class="opt-btn ${val==='none'?'selected':''}" onclick="setFard('${h.id}','none',0)">âœ–</div>
                    </div>
                </div>`;
        }).join('');
    }

    function renderSimpleList(target, items, date, isFriday = true) {
        const container = document.getElementById(target);
        container.innerHTML = items.map(h => {
            if(h.friday && !isFriday) return '';
            const done = localStorage.getItem(`v4_${currentUser}_${date}_${h.id}`) === 'true';
            return `
                <div class="habit-row">
                    ${h.link ? `<a href="${h.link}" target="_blank">ğŸ”— ${h.name}</a>` : `<span>${h.name}</span>`}
                    <input type="checkbox" ${done?'checked':''} onchange="toggleHabit('${h.id}', ${h.pts})">
                </div>`;
        }).join('');
    }

    function manageChat() {
        const today = new Date().toDateString();
        if(localStorage.getItem('chat_v4_date') !== today) { localStorage.setItem('chat_v4_log', JSON.stringify([])); localStorage.setItem('chat_v4_date', today); }
        displayChat();
    }
    function sendMsg() {
        const inp = document.getElementById('chat-input'); if(!inp.value) return;
        let msgs = JSON.parse(localStorage.getItem('chat_v4_log') || "[]");
        msgs.push({ u: currentUser, t: inp.value }); localStorage.setItem('chat_v4_log', JSON.stringify(msgs));
        inp.value = ""; displayChat();
    }
    function displayChat() {
        const box = document.getElementById('chat-msgs');
        box.innerHTML = JSON.parse(localStorage.getItem('chat_v4_log') || "[]").map(m => `<div><b>${m.u}:</b> ${m.t}</div>`).join('');
        box.scrollTop = box.scrollHeight;
    }

    window.onload = () => {
        document.getElementById('date-picker').value = new Date().toISOString().split('T')[0];
        updateView(); manageChat();
    };
</script>
</body>
</html>
