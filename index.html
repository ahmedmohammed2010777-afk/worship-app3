<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø§Ø¯ØªÙŠ Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #b8860b; --emerald: #2e7d32; --dark-red: #d32f2f; --soft-bg: #f4f7f6;
        }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--soft-bg); margin: 0; padding: 10px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø­Ø¯ÙŠØ« */
        .luxury-card { background: white; border-radius: 20px; padding: 12px; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); border: 1px solid rgba(184, 134, 11, 0.2); }
        .card-inner { border: 2px double var(--gold); border-radius: 15px; padding: 15px; text-align: center; }
        .naskh-font { font-family: 'Amiri', serif; font-size: 1.4rem; line-height: 1.7; margin: 8px 0; }

        /* Ù…Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        .family-selector { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .user-btn { padding: 8px 15px; border-radius: 20px; border: 2px solid var(--emerald); background: white; color: var(--emerald); cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 0.9rem; }
        .user-btn.active { background: var(--emerald); color: white; transform: scale(1.05); }

        /* Ø§Ù„Ø¨ÙˆØ¯ÙŠÙˆÙ… */
        .podium-container { background: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .podium-flex { display: flex; align-items: flex-end; justify-content: center; gap: 8px; height: 220px; margin-top: 35px; }
        .podium-step { flex: 1; display: flex; flex-direction: column; align-items: center; border-radius: 12px 12px 0 0; position: relative; padding-bottom: 10px; transition: all 0.5s ease; min-width: 80px; }
        .step-1 { background: linear-gradient(to top, #ffd700, #fffde7); height: 100%; border: 1px solid #ffcc00; }
        .step-2 { background: linear-gradient(to top, #c0c0c0, #f5f5f5); height: 80%; border: 1px solid #bdbdbd; }
        .step-3 { background: linear-gradient(to top, #cd7f32, #efebe9); height: 65%; border: 1px solid #a1887f; }
        .step-4 { background: #e0e0e0; height: 50%; border: 1px solid #9e9e9e; }
        .medal { font-size: 1.8rem; position: absolute; top: -35px; }
        .remain-tag { font-size: 0.7rem; color: var(--dark-red); background: rgba(255,255,255,0.8); padding: 2px 5px; border-radius: 5px; margin-top: 5px; font-weight: bold; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .section-box { background: white; border-radius: 15px; padding: 18px; margin-bottom: 15px; }
        .section-title { border-right: 5px solid var(--emerald); padding-right: 10px; margin-bottom: 15px; color: var(--emerald); font-weight: bold; }
        .task-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
        
        .opt-btn { font-size: 0.65rem; padding: 5px 8px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; background: white; }
        .opt-btn.active-masjid { background: var(--emerald); color: white; }
        .opt-btn.active-fard { background: #2196F3; color: white; }
        .opt-btn.active-qada { background: #757575; color: white; }

        .sunnah-badge { font-size: 0.7rem; background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 10px; }
        .link-card { display: flex; justify-content: space-between; padding: 12px; background: #fff; border: 1px solid var(--emerald); border-radius: 10px; text-decoration: none; color: var(--emerald); font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 15px;">
        <input type="date" id="main-calendar" onchange="init()" style="padding: 10px; border-radius: 10px; border: 2px solid var(--gold);">
        <h2 id="display-date" style="color: var(--gold); margin-top: 8px; font-size: 1.2rem;"></h2>
    </div>

    <div id="spiritual-header"></div>

    <div class="family-selector">
        <button class="user-btn active" onclick="switchUser(0)">Ø§Ù„Ø£Ø¨ Ù…Ø­Ù…Ø¯</button>
        <button class="user-btn" onclick="switchUser(1)">Ø§Ù„Ø£Ù… Ø´ÙŠÙ…Ø§Ø¡</button>
        <button class="user-btn" onclick="switchUser(2)">Ø£Ø­Ù…Ø¯ (Ø§Ù„Ø£ÙƒØ¨Ø±)</button>
        <button class="user-btn" onclick="switchUser(3)">ÙŠØ§Ø³ÙŠÙ† (Ø§Ù„Ø£ØµØºØ±)</button>
    </div>

    <div class="podium-container">
        <h3 style="color: var(--emerald); margin: 0; font-size: 1rem;">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¹Ø§Ø¦Ù„Ø©</h3>
        <div class="podium-flex" id="podium-ui"></div>
    </div>

    <div id="tasks-content">
        <div class="section-box">
            <h3 class="section-title">Ø§Ù„ÙØ±ÙˆØ¶ Ø§Ù„Ø®Ù…Ø³Ø©</h3>
            <div id="fard-list"></div>
        </div>

        <div class="section-box">
            <h3 class="section-title">Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù†ÙˆØ§ÙÙ„</h3>
            <div id="sunnah-list"></div>
        </div>

        <div class="section-box">
            <h3 class="section-title">Ø§Ù„Ø£ÙˆØ±Ø§Ø¯ ÙˆØ§Ù„Ù‚Ø±Ø¢Ù†</h3>
            <div id="daily-words"></div>
            <hr>
            <a href="https://alazkar.today/" target="_blank" class="link-card"><span>ğŸ“– Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡</span> ğŸ”—</a>
            <a href="https://quran.com/67" target="_blank" class="link-card" style="border-color: #2196F3; color: #2196F3;"><span>ğŸ‘‘ Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ</span> ğŸ“–</a>
            <div id="kahf-area"></div>
        </div>
    </div>
</div>

<script>
    const hadiths = ["Ù‚Ø§Ù„ ï·º: Â«Ù…ÙÙ†Ù’ ØµÙÙ„Ù‘ÙÙ‰ ÙÙÙŠ ÙŠÙÙˆÙ’Ù…Ù ÙˆÙÙ„ÙÙŠÙ’Ù„ÙØ©Ù Ø«ÙÙ†Ù’ØªÙÙŠÙ’ Ø¹ÙØ´Ù’Ø±ÙØ©Ù Ø±ÙÙƒÙ’Ø¹ÙØ©Ù‹ Ø¨ÙÙ†ÙÙŠÙ Ù„ÙÙ‡Ù Ø¨ÙÙŠÙ’ØªÙŒ ÙÙÙŠ Ø§Ù„Ù’Ø¬ÙÙ†Ù‘ÙØ©ÙÂ»", "Ù‚Ø§Ù„ ï·º: Â«Ø®ÙÙŠÙ’Ø±ÙÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ ØªÙØ¹ÙÙ„Ù‘ÙÙ…Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙˆÙØ¹ÙÙ„Ù‘ÙÙ…ÙÙ‡ÙÂ»"];
    const flashes = ["Ø§Ù„Ø¶Ø­Ù‰ ØµÙ„Ø§Ø© Ø§Ù„Ø£ÙˆØ§Ø¨ÙŠÙ†.", "Ø§Ù„ÙˆØªØ± Ø¬Ù†Ø© Ø§Ù„Ù‚Ù„ÙˆØ¨.", "Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ Ø´Ø±Ù Ø§Ù„Ù…Ø¤Ù…Ù†."];

    const sunnahData = [
        {n: "Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±", t: "Ù‚Ø¨Ù„ÙŠØ©", c: 2}, {n: "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±", t: "Ù‚Ø¨Ù„ÙŠØ©", c: 4},
        {n: "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±", t: "Ø¨Ø¹Ø¯ÙŠØ©", c: 2}, {n: "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨", t: "Ø¨Ø¹Ø¯ÙŠØ©", c: 2}, 
        {n: "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡", t: "Ø¨Ø¹Ø¯ÙŠØ©", c: 2}, {n: "ØµÙ„Ø§Ø© Ø§Ù„Ø¶Ø­Ù‰", t: "Ù†Ø§ÙÙ„Ø©", c: "2+"},
        {n: "Ø§Ù„Ø´ÙØ¹ ÙˆØ§Ù„ÙˆØªØ±", t: "Ù†Ø§ÙÙ„Ø©", c: 3}, {n: "Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„", t: "Ù†Ø§ÙÙ„Ø©", c: "Ø±ÙŠØ¯"}
    ];

    let currentUserIdx = 0;
    let familyData = [
        { name: "Ù…Ø­Ù…Ø¯", score: 0, remain: 0, tasks: {} },
        { name: "Ø´ÙŠÙ…Ø§Ø¡", score: 0, remain: 0, tasks: {} },
        { name: "Ø£Ø­Ù…Ø¯", score: 0, remain: 0, tasks: {} },
        { name: "ÙŠØ§Ø³ÙŠÙ†", score: 0, remain: 0, tasks: {} }
    ];

    function init() {
        const d = new Date(document.getElementById('main-calendar').value || new Date());
        const isFriday = d.getDay() === 5;
        document.getElementById('display-date').innerText = d.toLocaleDateString('ar-EG', {weekday:'long', day:'numeric', month:'long'});
        
        document.getElementById('spiritual-header').innerHTML = `
            <div class="luxury-card"><div class="card-inner"><span style="color:var(--gold)">âœ¨ Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…</span><p class="naskh-font">${hadiths[d.getDate()%hadiths.length]}</p></div></div>
            <div class="luxury-card" style="border-color:var(--emerald)"><div class="card-inner" style="border-color:var(--emerald)"><span style="color:var(--emerald)">ğŸ’¡ ÙˆÙ…Ø¶Ø© Ø§Ù„ÙŠÙˆÙ…</span><p class="naskh-font" style="font-size:1.1rem">${flashes[d.getDate()%flashes.length]}</p></div></div>
        `;

        renderTasks(isFriday);
        updatePodium();
    }

    function switchUser(idx) {
        currentUserIdx = idx;
        document.querySelectorAll('.user-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
        init();
    }

    function renderTasks(isFriday) {
        const user = familyData[currentUserIdx];
        
        // Ø§Ù„ÙØ±ÙˆØ¶
        const fList = document.getElementById('fard-list'); fList.innerHTML = "";
        ["Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¸Ù‡Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù…ØºØ±Ø¨", "Ø§Ù„Ø¹Ø´Ø§Ø¡"].forEach((p, i) => {
            let pName = (isFriday && i === 1) ? "Ø§Ù„Ø¬Ù…Ø¹Ø©" : p;
            let saved = user.tasks[pName] || "";
            fList.innerHTML += `
                <div class="task-row">
                    <span><b>${pName}</b></span>
                    <div class="prayer-options">
                        <button class="opt-btn ${saved==='masjid'?'active-masjid':''}" onclick="saveTask('${pName}','masjid')">ğŸ•Œ Ù…Ø³Ø¬Ø¯</button>
                        <button class="opt-btn ${saved==='fard'?'active-fard':''}" onclick="saveTask('${pName}','fard')">ğŸ‘¤ ÙØ±Ø¯</button>
                        <button class="opt-btn ${saved==='qada'?'active-qada':''}" onclick="saveTask('${pName}','qada')">ğŸ•’ Ù‚Ø¶Ø§Ø¡</button>
                    </div>
                </div>`;
        });

        // Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ù†ÙˆØ§ÙÙ„
        const sList = document.getElementById('sunnah-list'); sList.innerHTML = "";
        sunnahData.forEach((s, i) => {
            let key = s.n + i;
            sList.innerHTML += `<div class="task-row"><span>${s.n} <span class="sunnah-badge">${s.t}</span></span><input type="checkbox" ${user.tasks[key]?'checked':''} onchange="saveCheck('${key}', this.checked)"></div>`;
        });

        // Ø§Ù„Ø£ÙˆØ±Ø§Ø¯
        const wList = document.getElementById('daily-words'); 
        wList.innerHTML = `
            <div class="task-row"><span>Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span><input type="checkbox" ${user.tasks['quran_w']?'checked':''} onchange="saveCheck('quran_w', this.checked)"></div>
            <div class="task-row"><span>Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ</span><input type="checkbox" ${user.tasks['milk']?'checked':''} onchange="saveCheck('milk', this.checked)"></div>
        `;
        if(isFriday) {
            wList.innerHTML += `<div class="task-row" style="color:var(--emerald);font-weight:bold"><span>Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù</span><input type="checkbox" ${user.tasks['kahf']?'checked':''} onchange="saveCheck('kahf', this.checked)"></div>`;
            document.getElementById('kahf-area').innerHTML = `<a href="https://quran.com/18" target="_blank" class="link-card" style="background:#fff9c4"><span>ğŸ•Œ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù</span> ğŸ”—</a>`;
        } else { document.getElementById('kahf-area').innerHTML = ""; }
    }

    function saveTask(p, type) { 
        familyData[currentUserIdx].tasks[p] = (familyData[currentUserIdx].tasks[p] === type) ? "" : type;
        init(); 
    }
    function saveCheck(key, val) { 
        familyData[currentUserIdx].tasks[key] = val;
        init(); 
    }

    function updatePodium() {
        const d = new Date(document.getElementById('main-calendar').value || new Date());
        // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… = 5 ÙØ±ÙˆØ¶ + 8 Ø³Ù†Ù†/Ù†ÙˆØ§ÙÙ„ + ÙˆØ±Ø¯ Ù‚Ø±Ø¢Ù†ÙŠ + Ø³ÙˆØ±Ø© Ù…Ù„Ùƒ + (ÙƒÙ‡Ù Ø¥Ø°Ø§ Ø¬Ù…Ø¹Ø©)
        const total = 5 + 8 + 1 + 1 + (d.getDay()===5?1:0);

        familyData.forEach(user => {
            let done = Object.values(user.tasks).filter(v => v === true || v === 'masjid' || v === 'fard' || v === 'qada').length;
            user.score = Math.round((done/total)*100);
            user.remain = total - done;
        });

        const sorted = [...familyData].sort((a,b) => b.score - a.score);
        const ui = document.getElementById('podium-ui'); ui.innerHTML = "";
        
        [sorted[1], sorted[0], sorted[2], sorted[3]].forEach(m => {
            let step = m === sorted[0] ? "step-1" : (m === sorted[1] ? "step-2" : (m === sorted[2] ? "step-3" : "step-4"));
            let medal = m === sorted[0] ? "ğŸ¥‡" : (m === sorted[1] ? "ğŸ¥ˆ" : (m === sorted[2] ? "ğŸ¥‰" : "ğŸ…"));
            ui.innerHTML += `<div class="podium-step ${step}"><span class="medal">${medal}</span><b style="font-size:0.8rem">${m.name}</b><span style="font-size:0.85rem">${m.score}%</span><span class="remain-tag">Ø¨Ø§Ù‚ÙŠ: ${m.remain}</span></div>`;
        });
    }

    window.onload = () => { document.getElementById('main-calendar').valueAsDate = new Date(); init(); };
</script>
</body>
</html>            
