<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø­Ø±Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Changa:wght@400;700;800&display=swap');
body { font-family: 'Changa', sans-serif; background: #f0f7ff; color: #1e293b; margin: 0; padding: 10px; }
.neu-card { background: white; border-radius: 25px; padding: 20px; margin-bottom: 20px; border: 1px solid #e2e8f0; box-shadow: 0 4px 15px rgba(0,0,0,0.04); }

/* Ø§Ù„Ø¨ÙˆØ¯ÙŠÙˆÙ… */
.podium-box { display: flex; align-items: flex-end; justify-content: center; gap: 8px; height: 160px; margin: 15px 0; }
.podium-col { display: flex; flex-direction: column; align-items: center; width: 23%; transition: all 0.5s ease; }
.step { width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 800; color: white; border-radius: 12px 12px 0 0; }
.p1 { height: 95px; background: linear-gradient(#fbbf24, #d97706); }
.p2 { height: 75px; background: linear-gradient(#94a3b8, #475569); }
.p3 { height: 55px; background: linear-gradient(#b45309, #78350f); }
.p4 { height: 40px; background: linear-gradient(#cbd5e1, #94a3b8); }

/* Ø§Ù„Ø´Ø§Øª */
.chat-box { height: 130px; overflow-y: auto; background: #f8fafc; border-radius: 15px; padding: 10px; font-size: 11px; margin-bottom: 10px; border: 1px solid #e2e8f0; }
.chat-msg { margin-bottom: 5px; padding: 5px 10px; border-radius: 10px; background: white; width: fit-content; max-width: 90%; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

/* Ø§Ù„Ù…ØªØ±ÙˆÙƒØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© */
.pending-list { font-size: 8px; color: #ef4444; background: #fff5f5; border: 1px solid #feb2b2; border-radius: 10px; padding: 5px; margin-top: 5px; width: 100%; text-align: center; line-height: 1.3; max-height: 70px; overflow-y: auto; font-weight: bold; }
</style>
</head>
<body>
<div id="root"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDba3kZK5ibQEIRRjVIHL7JIOHixX_7rVs",
  authDomain: "ebada-656e1.firebaseapp.com",
  projectId: "ebada-656e1",
  storageBucket: "ebada-656e1.firebasestorage.app",
  messagingSenderId: "705608653939",
  appId: "1:705608653939:web:5ab3609a6f7ccc8675de06"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
window.docRef = doc(db, "worship", "family_ultimate_storage");
window.setDoc = setDoc;
window.onSnapshot = onSnapshot;
</script>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

const HADITHS = [
  "Â«Ø®ÙŠØ§Ø±ÙƒÙ… Ø®ÙŠØ§Ø±ÙƒÙ… Ù„Ø£Ù‡Ù„Ù‡Ù…ØŒ ÙˆØ£Ù†Ø§ Ø®ÙŠØ§Ø±ÙƒÙ… Ù„Ø£Ù‡Ù„ÙŠÂ»",
  "Â«ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© ØªÙØ¶Ù„ ØµÙ„Ø§Ø© Ø§Ù„ÙØ° Ø¨Ø³Ø¨Ø¹ ÙˆØ¹Ø´Ø±ÙŠÙ† Ø¯Ø±Ø¬Ø©Â»",
  "Â«Ø£Ø­Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø£Ø¯ÙˆÙ…Ù‡Ø§ ÙˆØ¥Ù† Ù‚Ù„Â»",
  "Â«Ù…Ù† Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø© Ø£Ø¶Ø§Ø¡ Ù„Ù‡ Ù…Ù† Ø§Ù„Ù†ÙˆØ± Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø¹ØªÙŠÙ†Â»",
  "Â«Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø·ÙŠØ¨Ø© ØµØ¯Ù‚Ø©Â»",
  "Â«ØªØ¨Ø³Ù…Ùƒ ÙÙŠ ÙˆØ¬Ù‡ Ø£Ø®ÙŠÙƒ Ù„Ùƒ ØµØ¯Ù‚Ø©Â»",
  "Â«Ù…ÙÙ†Ù’ ØºÙØ¯ÙØ§ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ù…ÙØ³Ù’Ø¬ÙØ¯Ù Ø£ÙÙˆÙ’ Ø±ÙØ§Ø­Ù Ø£ÙØ¹ÙØ¯Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙÙ‡Ù ÙÙÙŠ Ø§Ù„Ù’Ø¬ÙÙ†Ù‘ÙØ©Ù Ù†ÙØ²ÙÙ„Ù‹Ø§Â»"
];

function App() {
  const [data, setData] = useState({});
  const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
  const [msg, setMsg] = useState("");
  const users = ['Ù…Ø­Ù…Ø¯', 'Ø´ÙŠÙ…Ø§Ø¡', 'Ø£Ø­Ù…Ø¯', 'ÙŠØ§Ø³ÙŠÙ†'];

  useEffect(() => {
    const unsub = window.onSnapshot(window.docRef, (snap) => snap.exists() && setData(snap.data()));
    return () => unsub();
  }, []);

  const isFriday = useMemo(() => new Date(currentDate).getDay() === 5, [currentDate]);

  const tasks = useMemo(() => {
    const b = {
      p: ["Ø§Ù„ÙØ¬Ø±", isFriday ? "Ø§Ù„Ø¬Ù…Ø¹Ø©" : "Ø§Ù„Ø¸Ù‡Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù…ØºØ±Ø¨", "Ø§Ù„Ø¹Ø´Ø§Ø¡"],
      s: ["Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±", "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±", "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨", "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡", "Ø§Ù„Ø¶Ø­Ù‰"],
      n: ["Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø´ÙØ¹ ÙˆØ§Ù„ÙˆØªØ±"],
      a: ["Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­", "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡", "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…", "Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ", "Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ"]
    };
    if (isFriday) b.a.push("Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù");
    return b;
  }, [isFriday]);

  const update = async (u, t, v) => {
    const newData = { ...data, [currentDate]: { ...data[currentDate], [u]: { ...data[currentDate]?.[u], [t]: v } } };
    await window.setDoc(window.docRef, newData);
  };

  const sendMsg = async () => {
    if (!msg.trim()) return;
    const chat = data.chat || [];
    const newData = { ...data, chat: [...chat, { user: "Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©", text: msg, time: new Date().toLocaleTimeString('ar-EG') }].slice(-20) };
    await window.setDoc(window.docRef, newData);
    setMsg("");
  };

  const stats = useMemo(() => {
    const all = Object.values(tasks).flat();
    return users.map(u => {
      const d = data[currentDate]?.[u] || {};
      let s = 0, m = [];
      all.forEach(t => {
        const val = d[t];
        if (val === "Ù…Ø³Ø¬Ø¯") s += 3;
        else if (val === "Ø­Ø§Ø¶Ø±" || val === true) s += 2;
        else if (val === "Ù‚Ø¶Ø§Ø¡") s += 1;
        else m.push(t); // Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø© Ù…ØªØ±ÙˆÙƒØ©
      });
      return { name: u, score: s, missed: m };
    }).sort((a, b) => b.score - a.score);
  }, [data, currentDate, tasks]);

  return (
    <div className="max-w-md mx-auto pb-10">
      <header className="py-4 flex justify-between items-center px-2">
        <h1 className="text-2xl font-black text-blue-600 italic">Ù…ÙØ­Ù’Ø±Ø§Ø¨Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© âœ¨</h1>
        <input type="date" value={currentDate} onChange={(e)=>setCurrentDate(e.target.value)} className="border-2 border-blue-200 rounded-xl p-1 font-bold text-blue-700 outline-none text-xs" />
      </header>

      <div className="neu-card bg-blue-50 text-blue-800 text-[10px] text-center py-3 italic border-none leading-relaxed px-4">
        {HADITHS[new Date(currentDate).getDate() % HADITHS.length]}
      </div>

      <div className="neu-card border-blue-100 bg-blue-50/30">
        <h3 className="font-bold text-blue-600 mb-2 text-xs">ğŸ¤ Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„Ø·Ø§Ø¹Ø© (Ø¯Ø±Ø¯Ø´Ø©)</h3>
        <div className="chat-box">
          {(data.chat || []).map((c, i) => (
            <div key={i} className="chat-msg">
              <span className="font-bold text-blue-500">{c.user}: </span>{c.text}
            </div>
          ))}
        </div>
        <div className="flex gap-2">
          <input value={msg} onChange={(e)=>setMsg(e.target.value)} placeholder="Ø´Ø¬Ø¹ Ø£Ù‡Ù„Ùƒ..." className="flex-1 border rounded-xl px-3 py-1 text-xs outline-none" />
          <button onClick={sendMsg} className="bg-blue-600 text-white px-3 py-1 rounded-xl text-xs font-bold">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
      </div>

      <div className="neu-card">
        <h3 className="text-center font-bold text-amber-500 mb-2 text-xs">ğŸ–ï¸ ÙØ±Ø³Ø§Ù† Ø§Ù„ÙŠÙˆÙ…</h3>
        <div className="podium-box">
          {[stats[1], stats[0], stats[2], stats[3]].map((u, i) => (
            <div key={u.name} className="podium-col">
              {u.name === stats[0].name && <span className="text-xl">ğŸ‘‘</span>}
              <div className={`step ${['p2','p1','p3','p4'][i]}`}>
                <span className="text-sm">{u.score}</span>
              </div>
              <span className="text-[11px] font-bold mt-1">{u.name}</span>
              {u.missed.length > 0 ? (
                <div className="pending-list">
                  <strong>Ù…ØªØ¨Ù‚ÙŠ:</strong><br/>
                  {u.missed.join(' â€¢ ')}
                </div>
              ) : (
                <div className="text-[8px] text-emerald-600 mt-2 font-bold">ÙƒØ§Ù…Ù„ âœ…</div>
              )}
            </div>
          ))}
        </div>
      </div>

      <div className="neu-card">
        <h3 className="font-bold text-amber-600 border-r-4 pr-2 mb-3 text-xs">ğŸ•‹ Ø§Ù„ÙØ±ÙˆØ¶ (Ø§Ù„Ù…Ø³Ø¬Ø¯ ğŸ•Œ)</h3>
        <table className="w-full text-[10px]">
          <tbody>
            {tasks.p.map(p => (
              <tr key={p} className="border-t">
                <td className="py-2 font-bold">{p}</td>
                {users.map(u => (
                  <td key={u} className="px-1">
                    <select value={data[currentDate]?.[u]?.[p] || ""} onChange={e => update(u, p, e.target.value)} className="w-full border rounded p-1 text-[8px] outline-none">
                      <option value="">-</option>
                      <option value="Ù…Ø³Ø¬Ø¯">ğŸ•Œ Ù…Ø³Ø¬Ø¯</option>
                      <option value="Ø­Ø§Ø¶Ø±">âœ… ÙØ±Ø¯</option>
                      <option value="Ù‚Ø¶Ø§Ø¡">â³ Ù‚Ø¶Ø§Ø¡</option>
                    </select>
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <div className="neu-card">
        <h3 className="font-bold text-emerald-600 border-r-4 pr-2 mb-3 text-xs">âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ù‚ÙŠØ§Ù…</h3>
        {[...tasks.s, ...tasks.n].map(s => (
          <div key={s} className="flex justify-between items-center mb-2 border-b border-slate-50 pb-1">
            <span className="text-[10px] font-bold text-slate-600">{s}</span>
            <div className="flex gap-1">
              {users.map(u => (
                <button key={u} onClick={() => update(u, s, !data[currentDate]?.[u]?.[s])} className={`w-8 h-8 rounded-xl text-[10px] font-bold ${data[currentDate]?.[u]?.[s] ? 'bg-emerald-500 text-white shadow-md' : 'bg-slate-100 text-slate-300'}`}>{u[0]}</button>
              ))}
            </div>
          </div>
        ))}
      </div>

      <div className="neu-card">
        <h3 className="font-bold text-sky-600 border-r-4 pr-2 mb-3 text-xs">ğŸ“– Ø§Ù„Ø£ÙˆØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
        {tasks.a.map(w => (
          <div key={w} className="flex justify-between items-center mb-2">
            <span onClick={() => w.includes("Ø£Ø°ÙƒØ§Ø±") ? window.open("https://alazkar.today/") : window.open(w==="Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ"?"https://quran.com/67":"https://quran.com/18")} className="text-[10px] font-bold text-slate-700 cursor-pointer underline decoration-sky-100">{w}</span>
            <div className="flex gap-1">
              {users.map(u => (
                <button key={u} onClick={() => update(u, w, !data[currentDate]?.[u]?.[w])} className={`w-8 h-8 rounded-xl text-[10px] font-bold ${data[currentDate]?.[u]?.[w] ? 'bg-sky-500 text-white shadow-md' : 'bg-slate-100 text-slate-300'}`}>{u[0]}</button>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
